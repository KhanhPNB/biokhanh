const categorys = [
    {
        id: 1,
        name: "Store Decor",
        products: [
            { id: 1, name: "Decor Nội Thất", linkAFF: "https://s.shopee.vn/6pmewBi3vX", imgURL: "./assets/images/danhmuc_1/1.webp" },
            { id: 2, name: "PopMart", linkAFF: "https://s.shopee.vn/4q1aYc0JXM", imgURL: "./assets/images/danhmuc_1/2.webp" },
            { id: 3, name: "Decor Cây Giả", linkAFF: "https://s.shopee.vn/3q93Mn832h", imgURL: "./assets/images/danhmuc_1/3.webp" },
            { id: 4, name: "Decor Poter", linkAFF: "https://s.shopee.vn/4q1aYhlNXs", imgURL: "./assets/images/danhmuc_1/4.webp" },
            { id: 5, name: "Decor Đèn", linkAFF: "https://s.shopee.vn/5Kxr9fHrhQ", imgURL: "./assets/images/danhmuc_1/5.webp" },
            { id: 6, name: "Chuyên Máy Tinh Dầu", linkAFF: "https://s.shopee.vn/7fLlvzOk4f", imgURL: "./assets/images/danhmuc_1/6.webp" },
            { id: 7, name: "Decor Ghế Lười", linkAFF: "https://s.shopee.vn/1LRiOOzfHg", imgURL: "./assets/images/danhmuc_1/7.webp" },
            { id: 8, name: "Chuyên Ga Giường", linkAFF: "https://s.shopee.vn/9KTzv9TW54", imgURL: "./assets/images/danhmuc_1/8.webp" },
            { id: 9, name: "Chuyên Các Bình hoa", linkAFF: "https://s.shopee.vn/40STZae34W", imgURL: "./assets/images/danhmuc_1/9.webp" },
        ],
    },
    {
        id: 2,
        name: "Đồ Decor",
        products: [
            {
                id: 1,
                name: "Bể cá mini",
                linkAFF: "https://s.shopee.vn/9AAZfYXDwC",
                imgURL: "./assets/images/danhmuc_2/beca.webp"
            },
            {
                id: 2,
                name: "Hirono mime",
                linkAFF: "https://s.shopee.vn/30ZwKJO643",
                imgURL: "./assets/images/danhmuc_2/hirono.webp"
            },
            {
                id: 3,
                name: "Bàn mini",
                linkAFF: "https://s.shopee.vn/3LCmiwLjin",
                imgURL: "./assets/images/danhmuc_2/banmini.webp"
            },
            {
                id: 4,
                name: "Bàn Trà Nhỏ ",
                linkAFF: "https://s.shopee.vn/30ZwKL9bnE",
                imgURL: "./assets/images/danhmuc_2/bantranho.webp"
            },
            {
                id: 5,
                name: "Đèn Sứa",
                linkAFF: "https://s.shopee.vn/3AtMWihF9v",
                imgURL: "./assets/images/danhmuc_2/densua.webp"
            },
            {
                id: 6,
                name: "Tượng đựng giấy",
                linkAFF: "https://s.shopee.vn/4q1aVniGMT",
                imgURL: "./assets/images/danhmuc_2/tuonggiay.webp"
            },
            {
                id: 7,
                name: "Thảm Uno",
                linkAFF: "https://s.shopee.vn/2B0pKuoEJa",
                imgURL: "./assets/images/danhmuc_2/thamuno.webp"
            },
            {
                id: 8,
                name: "Tấm Decal Poster",
                linkAFF: "https://s.shopee.vn/LZB9Z7Ny4",
                imgURL: "./assets/images/danhmuc_2/tamdecal.webp"
            },
            {
                id: 9,
                name: "Gương lồi",
                linkAFF: "https://s.shopee.vn/2VdfjYqHGz",
                imgURL: "./assets/images/danhmuc_2/guongloi.webp"
            },
            {
                id: 10,
                name: "Gương hình dao",
                linkAFF: "https://s.shopee.vn/1B8I97mHtS",
                imgURL: "./assets/images/danhmuc_2/guongdao.webp"
            },
            {
                id: 11,
                name: "Khung Ảnh Mica",
                linkAFF: "https://s.shopee.vn/9KTzs988Em",
                imgURL: "./assets/images/danhmuc_2/khunganhmica.webp"
            },
            {
                id: 12,
                name: "Đồng hồ led",
                linkAFF: "https://s.shopee.vn/8pXjHF5AAA",
                imgURL: "./assets/images/danhmuc_2/dongholed.webp"
            },
            {
                id: 13,
                name: "Đèn rọi hoàng hôn",
                linkAFF: "https://s.shopee.vn/3LCmj9CQff",
                imgURL: "./assets/images/danhmuc_2/denhoanghon.webp"
            },
            {
                id: 14,
                name: "Tranh Canvas treo tường",
                linkAFF: "https://s.shopee.vn/8zr9TaLFbP",
                imgURL: "./assets/images/danhmuc_2/tranhcanvas.webp"
            },
            {
                id: 15,
                name: "Đèn cây đứng decor xếp li",
                linkAFF: "https://s.shopee.vn/4AltiiQ7HQ",
                imgURL: "./assets/images/danhmuc_2/dencay.webp"
            },
            {
                id: 16,
                name: "Máy Lọc Không Khí",
                linkAFF: "https://s.shopee.vn/3q93K7HUkU",
                imgURL: "./assets/images/danhmuc_2/mayhutbui.webp"
            },
            {
                id: 17,
                name: "Bàn Làm Việc",
                linkAFF: "https://s.shopee.vn/7fLltAlNbd",
                imgURL: "./assets/images/danhmuc_2/banlamviec.webp"
            },
            {
                id: 18,
                name: "Ghế lười hạt xốp kèm lót",
                linkAFF: "https://s.shopee.vn/2B0pL4oS7W",
                imgURL: "./assets/images/danhmuc_2/gheluoihatxop.webp"
            },
            {
                id: 19,
                name: "Tranh Mickey Mouse Decor",
                linkAFF: "https://s.shopee.vn/3AtMWwEYgY",
                imgURL: "./assets/images/danhmuc_2/tranhmickey.webp"
            },
            {
                id: 20,
                name: "Ghế văn phòng Avohome",
                linkAFF: "https://s.shopee.vn/7fLltGrH4C",
                imgURL: "./assets/images/danhmuc_2/ghevanphong.webp"
            },
            {
                id: 21,
                name: "Thảm lông đen trắng",
                linkAFF: "https://s.shopee.vn/gC1YSCaP5",
                imgURL: "./assets/images/danhmuc_2/thamlongdentrang.webp"
            },
            {
                id: 22,
                name: "Ghế Sofa Lười Thư Giãn",
                linkAFF: "https://s.shopee.vn/50L0iR5Akj",
                imgURL: "./assets/images/danhmuc_2/ghesofa.webp"
            },
            {
                id: 23,
                name: "Đèn Bàn Nghệ Thuật Bauhaus",
                linkAFF: "https://s.shopee.vn/6KqOIthXmq",
                imgURL: "./assets/images/danhmuc_2/denbauhaus.webp"
            },
            {
                id: 24,
                name: "Đèn Ngủ Hình Nấm Mini",
                linkAFF: "https://s.shopee.vn/1g4YkKldah",
                imgURL: "./assets/images/danhmuc_2/dennguhinhnammini.webp"
            },
            {
                id: 25,
                name: "Thảm lót sàn EMMO 8",
                linkAFF: "https://s.shopee.vn/9zjgff2JHw",
                imgURL: "./assets/images/danhmuc_2/thamlot8.webp"
            },
            {
                id: 26,
                name: "Bộ 10 Thẻ Bưu Thiếp",
                linkAFF: "https://s.shopee.vn/7V2Lh4tgf7",
                imgURL: "./assets/images/danhmuc_2/bo10thebuuthiep.webp"
            },
            {
                id: 27,
                name: "Kệ Sách Gỗ",
                linkAFF: "https://s.shopee.vn/2VdfjuLfQW",
                imgURL: "./assets/images/danhmuc_2/kesach.webp"
            },
        ]
    }
]

function closeModal() {
    document.getElementById("customModal").style.display = "none";
}

window.onload = function() {
    document.getElementById("customModal").style.display = "flex";
};
document.addEventListener("DOMContentLoaded", function () {
    
    
    const listProductContainer = document.getElementById("list-product");
    const dropdowns = [];
    let html = "";
    categorys.forEach(category => {
        dropdowns.push({ button: `btn-dm-${category.id}`, dropdown: `dropdown-dm-${category.id}` });

        html += `
            <button id="btn-dm-${category.id}" class="flex items-center justify-center gap-2 text-white text-base sm:text-lg font-medium py-3 px-6 rounded-full mt-4 mb-4 shadow-lg w-full">
                <span class="text-lg sm:text-xl">•</span>${category.name}<span class="text-lg sm:text-xl">•</span>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
                    <path fill-rule="evenodd" d="M12 16.5l-5-5h10l-5 5z" clip-rule="evenodd" />
                </svg>
            </button>
            <div id="dropdown-dm-${category.id}" class="transition-all duration-300 ease-in-out flex flex-col items-center gap-2 w-full" style="max-height: 0; overflow: hidden;">
                <div class="category-content grid grid-cols-2 sm:grid-cols-2 gap-4 p-4 w-full">
        `;

        category.products.forEach(product => {
            html += `
                <a href="${product.linkAFF}" class="w-full">
                    <div class="bg-white rounded-lg shadow-lg overflow-hidden flex flex-col h-full"> 
                        <img src="${product.imgURL}" alt="${product.name}" class="w-full h-auto object-cover">
                        <div class="p-4 flex flex-col flex-1"> 
                            <h3 class="font-bold text-gray-800 pb-2 text-sm sm:text-base">${product.name}</h3>
                            <div class="mt-auto">
                                <button class="bg-black text-white px-4 py-2 rounded-full w-full text-sm sm:text-base">Click me</button>
                            </div>
                        </div>
                    </div>
                </a>
            `;
        });

        html += `</div></div>`;
    });

    listProductContainer.innerHTML = html;

    dropdowns.forEach(({ button, dropdown }) => {
        const btn = document.getElementById(button);
        const drop = document.getElementById(dropdown);

        drop.style.transition = "max-height 0.3s ease-in-out";
        if (dropdowns[1] && dropdowns[1].button === button) {
            drop.style.maxHeight = "fit-content";
        }

        btn.addEventListener("click", function () {
            if (drop.style.maxHeight === "0px") {
                drop.style.maxHeight = "fit-content";
            } else {
                drop.style.maxHeight = "0px";
            }
        });
    });

    const searchInput = document.getElementById("search-product");

    // Chuyển đổi dấu tiếng Việt thành không dấu
    function removeDiacritics(str) {
        const accentMap = {
            'à': 'a', 'á': 'a', 'ả': 'a', 'ã': 'a', 'ạ': 'a',
            'ă': 'a', 'ằ': 'a', 'ắ': 'a', 'ẳ': 'a', 'ẵ': 'a', 'ặ': 'a',
            'â': 'a', 'ầ': 'a', 'ấ': 'a', 'ẩ': 'a', 'ẫ': 'a', 'ậ': 'a',
            'è': 'e', 'é': 'e', 'ẻ': 'e', 'ẽ': 'e', 'ẹ': 'e',
            'ê': 'e', 'ề': 'e', 'ế': 'e', 'ể': 'e', 'ễ': 'e', 'ệ': 'e',
            'ì': 'i', 'í': 'i', 'ỉ': 'i', 'ĩ': 'i', 'ị': 'i',
            'ò': 'o', 'ó': 'o', 'ỏ': 'o', 'õ': 'o', 'ọ': 'o',
            'ô': 'o', 'ồ': 'o', 'ố': 'o', 'ổ': 'o', 'ỗ': 'o', 'ộ': 'o',
            'ơ': 'o', 'ờ': 'o', 'ớ': 'o', 'ở': 'o', 'ỡ': 'o', 'ợ': 'o',
            'ù': 'u', 'ú': 'u', 'ủ': 'u', 'ũ': 'u', 'ụ': 'u',
            'ư': 'u', 'ừ': 'u', 'ứ': 'u', 'ử': 'u', 'ữ': 'u', 'ự': 'u',
            'ỳ': 'y', 'ý': 'y', 'ỷ': 'y', 'ỹ': 'y', 'ỵ': 'y',
            'đ': 'd', 'Đ': 'd'
        };
        return str.split('').map(char => accentMap[char] || char).join('').toLowerCase();
    }

    searchInput.addEventListener("input", function () {
        const searchText = removeDiacritics(searchInput.value.trim());

        dropdowns.forEach(({ dropdown }) => {
            const categoryDropdown = document.getElementById(dropdown);
            let hasMatch = false;

            document.querySelectorAll(`#${dropdown} .category-content a`).forEach((product) => {
                const productName = removeDiacritics(product.querySelector("h3").textContent);
                
                if (productName.includes(searchText)) {
                    product.style.display = "block";
                    hasMatch = true;
                } else {
                    product.style.display = "none";
                }
            });

                // Nếu có sản phẩm phù hợp, mở dropdown, ngược lại đóng dropdown
                if (dropdown === "dropdown-dm-2" ,"dropdown-dm-1") { // Giữ Đồ Decor luôn mở
                    categoryDropdown.style.maxHeight = "500px";
                    categoryDropdown.style.overflowY = "auto"; // Cho phép cuộn xuống bên trong dropdown
                    categoryDropdown.style.overflowX = "hidden"; // Tránh cuộn ngang gây lỗi UI
                } else {
                    categoryDropdown.style.maxHeight = hasMatch ? "500px" : "0px";
                }
        });
    });

});
